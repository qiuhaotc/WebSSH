<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>WebSSH</title>
    <base href="/" />
    <link href="css/bootstrap/bootstrap.min.css" rel="stylesheet" />
    <link href="css/app.css" rel="stylesheet" />
    <link href="manifest.json" rel="manifest" />
    <link rel="apple-touch-icon" sizes="512x512" href="icon-512.png" />
    <link rel="stylesheet" href="css/xterm.min.css" />
</head>

<body>
    <app>Loading...</app>

    <div id="blazor-error-ui">
        An unhandled error has occurred.
        <a href="" class="reload">Reload</a>
        <a class="dismiss">🗙</a>
    </div>
    <script src="js/xterm.js"></script>
    <script src="js/addon-fit.min.js"></script>
    <script src="js/xtermInterop.js"></script>
    <script src="_framework/blazor.webassembly.js"></script>
    <script>
        // Enhanced Service Worker registration with update detection
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('service-worker.js').then(function(registration) {
                console.log('Service Worker registered');
                
                // Listen for updates
                registration.addEventListener('updatefound', function() {
                    const newWorker = registration.installing;
                    newWorker.addEventListener('statechange', function() {
                        if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                            // New service worker available, reload to get the latest version
                            console.log('New version available! Reloading...');
                            setTimeout(function() {
                                window.location.reload();
                            }, 2000);
                        }
                    });
                });
            });
            
            // Listen for controller change (when new SW takes over)
            navigator.serviceWorker.addEventListener('controllerchange', function() {
                console.log('Service Worker controller changed, reloading page...');
                window.location.reload();
            });
        }
    </script>
    <script src="js/main.js"></script>
</body>
</html>
